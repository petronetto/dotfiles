#!/usr/bin/env zsh

##############################################################################################
#     888~-_               d8                                        d8     d8               #
#     888   \   e88~~8e  _d88__ 888-~\  e88~-_  888-~88e  e88~~8e  _d88__ _d88__  e88~-_     #
#     888    | d888  88b  888   888    d888   i 888  888 d888  88b  888    888   d888   i    #
#     888   /  8888__888  888   888    8888   | 888  888 8888__888  888    888   8888   |    #
#     888_-~   Y888    ,  888   888    Y888   ' 888  888 Y888    ,  888    888   Y888   '    #
#     888       "88___/   "88_/ 888     "88_-~  888  888  "88___/   "88_/  "88_/  "88_-~     #
##############################################################################################

# Homebrew - Ensure Homebrew is loaded before any plugins that might depend on it
if [[ $(uname -m) == "arm64" ]] && [[ -f /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -f /usr/local/bin/brew ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
fi

# Helper function to source files if they exist
source_if_exists() {
  local file="$1"
  [[ ! -f "$file" ]] || source "$file"
}

# Source all .zsh files in a directory
source_dir() {
  local dir="$1"
  if [[ -d "$dir" ]]; then
    for file in "$dir"/*.zsh(N); do
      source "$file"
    done
  fi
}

# Load antidote plugin manager
source_if_exists "$ZDOTDIR/antidote.zsh"

# CLI tools initialization
command -v starship &>/dev/null && eval "$(starship init zsh)"
command -v zoxide &>/dev/null && eval "$(zoxide init zsh)"
command -v atuin &>/dev/null && eval "$(atuin init zsh --disable-up-arrow)"

# Core configuration (needs to be loaded first)
source_dir "$ZDOTDIR/config"

# Completions
source_dir "$ZDOTDIR/completions"

# Functions
source_dir "$ZDOTDIR/functions"

# Aliases
source_dir "$ZDOTDIR/aliases"

# Private configurations
source_dir "$ZDOTDIR/private"
